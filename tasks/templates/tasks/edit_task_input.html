<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>タスク編集</title>
    <script>
    function editTask(event) {
        event.preventDefault();
        const data = {
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            start_date: document.getElementById('start_date').value,
            until_date: document.getElementById('until_date').value,
            category_id: document.getElementById('category_id').value
        };
        fetch('/api/tasks/edit/{{ task.id }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            if(result.success) {
                window.location.href = '/';
            } else {
                alert('編集失敗: ' + (result.error || '不明なエラー'));
            }
        });
    }
    </script>
</head>
<body>
    <h1>タスク編集</h1>
    <form onsubmit="editTask(event)">
        <label>件名: <input type="text" id="title" value="{{ task.title }}" required></label><br>
        <label>説明: <textarea id="description">{{ task.description }}</textarea></label><br>
        <label>カテゴリー:
            <select id="category_id">
                <option value="">--選択--</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}" {% if task.categories and task.categories.id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>
        </label><br>
        <label>期限_開始日: <input type="date" id="start_date" value="{{ task.start_date }}" required></label><br>
        <label>期限_終了日: <input type="date" id="until_date" value="{{ task.until_date }}" required></label><br>
        <button type="submit">保存</button>
    </form>
    <a href="/">一覧に戻る</a>
</body>
</html> 